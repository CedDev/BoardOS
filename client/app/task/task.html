<div ng-include="'components/navbar/navbar.html'"></div>
<!-- BEGIN PAGE CONTENT-->
<div class="row profile" cg-busy="myPromise">
  <div class="col-md-12">
    <!--BEGIN TABS-->
    <div class="row profile-nav">
      <!--start col-md-9-->
      <div class="col-md-9 " ng-if="task._id">
        <!-- Title -->
        <div class="row">
          <div class="col-md-2" ng-if="task._id">
            <button type="button" name="button" style="margin-bottom:5px;width:100%" class="btn btn-xs btn-outline btn-info" ng-click="refreshTask()">Refresh</button>
            <img src="assets/images/todo.png" class="img-responsive" alt="" />
          </div>
          <div class="col-md-10">
            <div class="row">
              <div class="col-md-9 col-sm-12 profile-info">
                <h1>
                                    <a href="#" style="color:black!important" editable-text="task.name" e-style="width: 500px" buttons="right">{{ task.name || 'Please give a name of your task' }}</a>
                                </h1>
                <ul class="list list-inline">
                  <li style="margin-top:5px">
                    <i class="fa fa-flash"></i>
                    <span class="text-muted" style="margin-right:10px">
                                Activity
                              </span> <a href="#" editable-text="task.activity" e-style="width: 500px" e-uib-typeahead="activity.longname for activity in activities | filter:$viewValue | limitTo:8">
                                {{task.activity || 'Please give activity' }}
                              </a>
                  </li><br>
                  <li style="margin-top:5px">
                    <i class="fa fa-map-marker"></i>
                    <span class="text-muted" style="margin-right:10px">
                              Context
                            </span> <a href="#" editable-text="task.context" e-style="width: 500px" e-uib-typeahead="context.longname for context in contexts | filter:$viewValue | limitTo:8">
                              {{task.context || 'Please give context' }}
                            </a>
                  </li>
                </ul>
                <div class="row">
                  <div class="descriptionTask">
                    <span ng-if="task.description">Description : </span>
                    <a href="#" editable-textarea="task.description" style="color:grey!important;margin-right:25px" e-label="Description" e-style="width: 500px">{{ task.description || ' + Description' }}</a>
                    <div class="" style="height:10px;" ng-if="task.description || task.hypothesis">
                      <br>
                    </div>
                    <span ng-if="task.hypothesis">Hypothesis : </span>
                    <a href="#" style="color:grey!important;margin-right:25px" e-label="Hypothesis" editable-text="task.hypothesis" e-style="width: 400px" buttons="right">{{ task.hypothesis || ' + Hypothesis ' }}</a>
                    <div class="" style="height:10px;" ng-if="task.hypothesis || task.risks">
                      <br>
                    </div>
                    <span ng-if="task.risks">Risks : </span>
                    <a href="#" style="color:grey!important;margin-right:25px" e-label="Risks" editable-textarea="task.risks" e-style="width: 400px" buttons="right">{{ task.risks || ' + Risks' }}</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--Metrics  -->
        <div class="row stats-overview-cont" ng-if="task._id" style="padding-top:15px">
          <div class="portlet sale-summary" ng-if="task._id">
            <div class="portlet-title">
              <div class="caption">
                Main task
                <small style="margin-left:25px">Status:
                  <span class="text-info">{{task.lastmetric.status}} </span>
                </small>
              </div>
              <div class="tools">
                <button type="button" name="button" style="margin-left:5px;" class="btn btn-xs btn-outline btn-info">ReOpen</button>
                <button type="button" name="button" style="margin-left:5px;" class="btn btn-xs btn-outline btn-warning">Withdraw</button>
                <button type="button" name="button" style="margin-left:5px;" class="btn btn-xs btn-outline btn-danger">Delete</button>
              </div>
            </div>
            <div class="portlet-body" style="padding-bottom:5px;overflow: auto;">
              <div class="col-md-2 col-sm-12 ">
                <div class="stats-overview stat-block">
                  <div class="details" style="height:45px;">
                    <div class="title">
                      <span class="text-muted">Start
                          </span>
                      <span class="pull-right text-info">
                    <a href="#" editable-bsdate="task.startDate" e-is-open="opened.$data" e-ng-click="open($event,'$data')" e-datepicker-popup="mediumDate">
                        {{ (task.startDate | date:'mediumDate') || 'empty' }}
                      </a>
                  </span>
                    </div>
                    <div ng-if="task.lastmetric.startDate !== task.startDate " class="">
                      <small style="font-size:9px">Reestimated:
                          </small>
                      <small class="pull-right" ng-class="(lateStart) ?'bg-info text-info':'bg-success text-success'">{{task.lastmetric.startDate | date:'mediumDate'}}</small>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-3 col-sm-12">
                <div class="stats-overview ">
                  <div class="details" style="height:65px;">
                    <div class="title">
                      <small class="text-muted">Progress</small> <a href="#" editable-text="task.lastmetric.progress" e-style="width: 50px;height:20px;font-size:12px;" buttons="no">{{ task.lastmetric.progress || 0}}</a>
                      <small class="text-muted">%</small>
                      <div class="pull-right">
                        <small class="text-muted">Spent&nbsp;
                    </small>
                        <span>
                      <a href="#" editable-number="task.lastmetric.timeSpent" e-style="width: 60px" buttons="no">{{ task.lastmetric.timeSpent || 0}}</a>
                      <small class="text-muted">days</small>
                    </span>
                      </div>
                    </div>
                    <span class="row" style="padding:0;margin:0;">
                  <span class="col-sm-3" style="padding:5px 0 0 0">
                    <span class="pull-right" style="margin-right:10px;">
                    </span>
                    </span>
                    <span class="col-sm-9" style="padding:5px">
                  <uib-progressbar value="task.lastmetric.progress" style=";height:20px" type="info"></uib-progressbar>
                </span>

                    </span>
                    <div class="row" style="padding:0;margin:0">
                      <small class="text-muted">Estimate
                </small>
                      <span>
                  <a href="#" editable-number="task.load" e-style="width: 60px" buttons="no">{{ task.load || 0}}</a>
                    </span>
                      <small>days</small>

                      <div ng-if="task.lastmetric.projectedWorkload !== task.load" class="pull-right">
                        <small>Reestimated:</small>
                        <small ng-class="(task.lastmetric.projectedWorkload > task.load)?'bg-danger text-danger':'bg-success text-success'">
                      {{task.lastmetric.projectedWorkload}}</small>
                        <small>  days  </small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-2 col-sm-4">
                <div class="stats-overview stat-block ">
                  <div class="details " style="height:45px;">
                    <div class="title">
                      <span class="text-muted">Due Date
                          </span>
                      <span class="pull-right  text-info">
                  <a href="#" editable-bsdate="task.endDate" e-is-open="opened.$data2"                              e-ng-click="open($event,'$data2')"                            e-datepicker-popup="mediumDate">
                      {{ (task.endDate | date:'mediumDate') || 'empty' }}
                    </a>
                </div>
                <div ng-if="task.lastmetric.endDate !== task.endDate " class="">
                  <small style="font-size:9px">Reestimated:
                          </small>
                  <small class="pull-right" ng-class="(lateEnd)?'bg-danger text-danger':'bg-success text-success'">{{task.lastmetric.endDate | date:'mediumDate'}}</small>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-sm-12">
            <div class="stats-overview stat-block">
              <div class="details" style="height:45px;">
                <div class="title">
                  <span style="margin-left:-5px;">Confidence</span>
                      <span class="pull-right text-info">
                    <a href="#" editable-text="task.lastmetric.trust" e-style="width: 50px;height:20px;font-size:12px;" buttons="no">{{ task.lastmetric.trust || 100}}</a>
                    %</span>
                    </div>
                    <div class="">
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-3 col-sm-12">
                <div class="stats-overview stat-block ">
                  <div class="details" style="height:100px;">
                    <div class="title">
                      <span class="text-muted"><b> Delivery Status</b><small> (only Finished task)</small>
                          </span>
                    </div>
                    <div class="" style="padding-bottom:7px;padding-top:3px;">
                      User Satisfaction
                      <small class="pull-right">
                    <span class="pull-right" style="margin-right:10px;">
                        <a href="#" editable-text="task.lastmetric.userSatisfaction" e-style="width: 50px;height:20px;font-size:12px;" buttons="no">{{ task.lastmetric.userSatisfaction || 0}}</a>
                        %
                    </span>
                  </small>
                    </div>
                    <div class="" style="padding-bottom:7px;">

                      Actor Satisfaction
                      <small class="pull-right">
                    <span class="pull-right" style="margin-right:10px;">
                        <a href="#" editable-text="task.lastmetric.actorSatisfaction" e-style="width: 50px;height:20px;font-size:12px;" buttons="no">{{ task.lastmetric.actorSatisfaction || 0}}</a>
                        %
                    </span>
                  </small>
                    </div>

                    <div class="">
                      Deliverables as defined
                      <small class="pull-right">
                    <span class="pull-right" style="margin-right:10px;">
                        <a href="#" editable-text="task.lastmetric.deliverableStatus" e-style="width: 50px;height:20px;font-size:12px;" buttons="no">{{ task.lastmetric.deliverableStatus || 0}}</a>
                        %
                    </span>
                  </small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--Todo + Comments  -->
        <div class="row">
          <div class="col-md-5 col-sm-12" style="padding-right:25px">
            <div class="row stats-overview-cont" ng-if="task._id" style="padding-top:15px">
              <div class="portlet sale-summary" ng-if="task._id">
                <div class="portlet-title">
                  <div class="caption">
                    TodoList
                  </div>
                  <div class="tools">
                    Number : <span class="text-info">{{model.length}}</span>
                  </div>
                </div>
                <!-- <div class="row">
                  <div class="col-xs-6">
                    <div class="input-group">
                      <span class="input-group-btn">
                        <button class="btn btn-default" type="button"><span class="glyphicon glyphicon-search"></span></button>
                      </span>
                      <input  type="search" class="form-control" placeholder="Search" ng-model="todoSearch">
                    </div>
                  </div>
                  <div class="col-xs-6">
                    <ul class="list-inline" style="padding-top:20px">
                      <li class="btn btn-xs btn-default" ng-class="{'active' : show == 'All' }" ng-click="show='All'"><a  href="#">All</a></li>
                      <li class="btn btn-xs btn-default" ng-class="{'active' : show == 'Incomplete' }" ng-click="show='Incomplete'"><a   href="#">Incomplete</a></li>
                      <li class="btn btn-xs btn-default" ng-class="{'active' : show == 'Complete' }" ng-click="show='Complete'"><a href="#">Complete</a></li>
                    </ul>
                  </div>
                </div> -->
                <div class="portlet-body" style="padding-bottom:5px;">
                  <div class="row">
                    <div class="form-group" style="width:94%;margin-left:20px;padding-bottom:10px">
                      <div class="input-group">
                        <input class="form-control" type="text" ng-model="newTodo" placeholder="Add New Todo" ng-enter>
                      <span class="input-group-btn">
                        <button class="btn btn-outline btn-info" type="button"><span ng-click="addTodo()">Add</button>
                      </span>
                    </div>
                    </div>
                  </div>
                    <div class="row">
                      <ul class="" ui-sortable="todoSortable" style="-webkit-padding-start: 15px!important;" >
                        <li class="todoTask" ng-repeat="todo in model track by $index | filter:showFn | filter :todoSearch ">
                          <div class="circularToggleButtonView taskCheckboxNodeView " ng-class="todo.isDone ? ' circularToggleButtonView--toggledOn': 'circularToggleButtonView--toggledOff'">
                          <div class="circularButtonView circularToggleButtonView-button circularButtonView--xsmall circularButtonView--onWhiteBackground circularButtonView--active">
                            <span class="circularButtonView-label">
                              <svg class="svgIcon " viewBox="0 0 32 32" title="checkmark">
                                <polygon points="27.672,4.786 10.901,21.557 4.328,14.984 1.5,17.812 10.901,27.214 30.5,7.615 "></polygon>
                              </svg>
                            </span>
                          </div>
                          <span ng-class="{'barre':todo.isDone}"><span style="color:black" >{{todo.taskName}}</span></span>
                          </div>
                          <div class="pull-right" style="margin-top:-20px;margin-right:20px;">
                            <a>
                              <div class="circularButtonView circularToggleButtonView-button circularButtonView--small circularButtonView--onWhiteBackground">
                                <span class="circularButtonView-label">
                              <svg class="svgIcon task-row-due-date-icon" viewBox="0 0 32 32" title="calendar">
                                <rect x="16" y="16" width="2" height="2"></rect><rect x="20" y="16" width="2" height="2"></rect>
                                <rect x="20" y="20" width="2" height="2"></rect><rect x="16" y="20" width="2" height="2"></rect>
                                <rect x="8" y="20" width="2" height="2"></rect><rect x="8" y="24" width="2" height="2"></rect>
                                <rect x="16" y="24" width="2" height="2"></rect><rect x="12" y="16" width="2" height="2"></rect>
                                <rect x="12" y="20" width="2" height="2"></rect><rect x="12" y="24" width="2" height="2"></rect>
                                <path d="M22,2V0h-2v2h-8V0h-2v2H2v30h28V2H22z M28,30H4V12h24V30z M28,10H4V4h6v2h2V4h8v2h2V4h6V10z"></path>
                              </svg>
                            </span>
                          </div>
                            </a>
                            <a>
                              <div class="circularButtonView circularToggleButtonView-button circularButtonView--small circularButtonView--onWhiteBackground">
                                <span class="circularButtonView-label">
                              <svg class="svgIcon task-row-assignee-icon" viewBox="0 0 32 32" title="unassigned">
                                <path d="M20.534,16.765C23.203,15.204,25,12.315,25,9c0-4.971-4.029-9-9-9S7,4.029,7,9c0,3.315,1.797,6.204,4.466,7.765C5.962,18.651,2,23.857,2,30c0,0.681,0.065,1.345,0.159,2h27.682C29.935,31.345,30,30.681,30,30C30,23.857,26.038,18.651,20.534,16.765z M9,9c0-3.86,3.14-7,7-7s7,3.14,7,7s-3.14,7-7,7S9,12.86,9,9z M4,30c0-6.617,5.383-12,12-12s12,5.383,12,12H4z"></path>
                              </svg>
                            </span>
                          </div>
                            </a>
                            <!-- <button type="button" class=" " aria-hidden="true" ng-click="deleteTodo(todo)">&times;</button> -->
                          </div>
                        </li>
                      </ul>
                    </div>

                </div>
                </div>
                </div>
          </div>
          <div class="col-md-7 col-sm-12" style="padding-left:25px">
            <div class="row stats-overview-cont" ng-if="task._id" style="padding-top:15px">
              <div class="portlet sale-summary" ng-if="task._id">
                <div class="portlet-title">
                  <div class="caption">
                    Comments, Informations & Links
                  </div>
                  <div class="tools">
                    Number : <span class="text-info">{{0}}</span>
                    <button type="button" name="button" style="margin-left:5px;" class="btn btn-xs btn-outline btn-info">Add</button>

                  </div>
                </div>
                <div class="portlet-body" style="padding:0;overflow: auto;">
                  <div class="" style="height:35px;background-color:lightgrey;padding:0;margin:0">
                    <div class="">
                      <img alt="" ng-src="assets/images/avatars/{{currentUser._id}}.png" style="width:30px;height:30px" class="img-circle" err-src="assets/images/avatars/avatar.png" />&nbsp;
                    </div>
                    <div class="">

                    </div>
                  </div>
                </div>
                </div>
                </div>
          </div>
        </div>
      </div>
      <!--end col-md-9-->
      <!--start col-md-3-->
      <div class="col-md-3">
        <!-- Alerts -->
        <div class="" id="Alert">
          <div class="portlet sale-summary" ng-if="task._id">
            <div class="portlet-title">
              <div class="caption">
                Alerts
              </div>
              <div class="tools">
              </div>
            </div>
          </div>
          <div class="stats-overview stat-block">
            <div class="details">
              <table class="table table-striped table-bordered table-hover">
                <tbody style="text-align:center;">
                  <tr ng-repeat="KPI in task.alerts | orderBy:'constraint' track by $index" on-finish-render>
                    <td>{{KPI.constraint}}</td>
                    <td style="text-align:left;"><a href="/KPI/{{KPI._id}}">{{KPI.name}}</a></td>
                    <td style="text-align:left;font-size:13px">
                      <span ng-if="KPI.calcul.task !== undefined && KPI.calcul.task !== null" class="badge" ng-style="{'background-color':giveMeMyColor(KPI.calcul.task, KPI.category)}" style="height:25px;line-height:20px;width:25px;margin-right: 15px">&nbsp;&nbsp;</span>                      {{KPI.calcul.task}}
                      <span ng-if="KPI.category === 'Goal' && KPI.calcul.task !== undefined && KPI.calcul.task !== null"> %</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <!-- KPIs -->
        <div class="" id="KPI">
          <div class="portlet sale-summary" ng-if="task._id">
            <div class="portlet-title">
              <div class="caption">
                KPIs
              </div>
              <div class="tools">
              </div>
            </div>
          </div>
          <div class="stats-overview stat-block">
            <div class="details">
              <table class="table table-striped table-bordered table-hover">
                <tbody style="text-align:center;">
                  <tr ng-repeat="KPI in task.kpis | orderBy:'constraint' track by $index" on-finish-render>
                    <td>{{KPI.constraint}}</td>
                    <td style="text-align:left;"><a href="/KPI/{{KPI._id}}">{{KPI.name}}</a></td>
                    <td style="text-align:left;font-size:13px">
                      <span ng-if="KPI.calcul.task !== undefined && KPI.calcul.task !== null" class="badge" ng-style="{'background-color':giveMeMyColor(KPI.calcul.task, KPI.category)}" style="height:25px;line-height:20px;width:25px;margin-right: 15px">&nbsp;&nbsp;</span>                      {{KPI.calcul.task}}
                      <span ng-if="KPI.category === 'Goal' && KPI.calcul.task !== undefined && KPI.calcul.task !== null"> %</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <!-- Team -->

        <div class="portlet sale-summary" ng-if="task._id">
          <div class="portlet-title">
            <div class="caption">
              Team
            </div>
            <div class="tools">
              <span class="text-info">{{task.actors.length + task.watchers.length}}</span>
            </div>
          </div>
          <div class="portlet-body">
            <ul class="list-unstyled">
              <li style="margin-top:10px;margin-bottom:10px;">
                <div class="pull-left" style="color:#898E95;width:65px;margin-top:10px">Actors</div>
                <div class="pull-left" ng-repeat="actor in task.actors">
                  <img alt="" ng-src="assets/images/avatars/{{actor._id}}.png" style="width:30px;height:30px;" class="img-circle" err-src="assets/images/avatars/avatar.png" />&nbsp;
                </div>
                <div class="circularButtonView add-button detailsFollowersView-addButton circularButtonView--small circularButtonView--onWhiteBackground circularButtonView--active">
                  <span class="circularButtonView-label">
                                          <svg class="svgIcon add-followers-icon" viewBox="0 0 32 32" title="plus">
                                            <polygon points="28,14 18,14 18,4 14,4 14,14 4,14 4,18 14,18 14,28 18,28 18,18 28,18"></polygon>
                                          </svg>
                                        </span>
                </div>
              </li>
              <li style="margin-top:10px">
                <div class="pull-left" style="color:#898E95;width:65px;margin-top:18px">Followers</div>
                <div class="pull-left" ng-repeat="actor in task.watchers" style="margin-top:10px">
                  <img alt="" ng-src="assets/images/avatars/{{actor._id}}.png" style="width:30px;height:30px" class="img-circle" err-src="assets/images/avatars/avatar.png" />&nbsp;
                </div>
                <div style="margin-top:10px" class="circularButtonView add-button detailsFollowersView-addButton circularButtonView--small circularButtonView--onWhiteBackground circularButtonView--active">
                  <span class="circularButtonView-label">
                                        <svg class="svgIcon add-followers-icon" viewBox="0 0 32 32" title="plus">
                                          <polygon points="28,14 18,14 18,4 14,4 14,14 4,14 4,18 14,18 14,28 18,28 18,18 28,18"></polygon>
                                        </svg>
                                      </span>
                </div>
                <!-- <div class="sale-num" style="font-size:14px;color:grey;margin-top:10px">  <i class="fa fa-bell-o"></i>
                                          <a href="#" ng-click="watchThisTask()" ng-if="task._id">
                                            {{taskIsWatched}}
                                          </a> </div> -->
              </li>
            </ul>
          </div>
        </div>
        <!-- Dashboards -->
        <div class="" id="Dashboards">
          <div class="portlet sale-summary" ng-if="task._id">
            <div class="portlet-title">
              <div class="caption">
                Dashboards
              </div>
              <div class="tools">
                <span class="text-info">{{0}}</span>
              </div>
            </div>
          </div>
          <div class="stats-overview stat-block">
            <div class="details">
              <div tab-dashboard data="task" ng-if="task"></div>
            </div>
          </div>
        </div>
      </div>
      <!--end col-md-3-->
    </div>
    <!--end row-->
  </div>
  <!-- END PAGE CONTENT-->
</div>
