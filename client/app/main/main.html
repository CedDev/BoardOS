<div ng-include="'components/navbar/navbar.html'"></div>
<div class="row">
    <!-- BEGIN OVERVIEW STATISTIC BARS-->
    <div class="row stats-overview-cont">
        <div class="col-md-2 col-sm-4 ">
            <div class="stats-overview stat-block">
                <div class="isloading" ng-if="!dataKPIs">Loading
                    <br/><img src="assets/images/ajax-loader_blue.gif">
                </div>
                <div class="details " ng-if="dataKPIs">
                    <div class="title"><a href="/KPIs"><span style="font-weight:bold;color:#1f77b4">{{KPIs.length}}</span> KPIs</a>
                    </div>
                    <nvd3 options="options" data="dataKPIs"></nvd3>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4">
            <div class="stats-overview stat-block">
                <div class="isloading" ng-if="!dataTasks">Loading
                    <br/><img src="assets/images/ajax-loader_blue.gif">
                </div>
                <div class="details" ng-if="dataTasks">
                    <div class="title"><a href="/tasks"><span style="font-weight:bold;color:#9467bd">{{tasksNb|| 0 }}</span> Tasks</a>
                    </div>
                    <nvd3 options="optionsTasks" data="dataTasks"></nvd3>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4">
            <div class="stats-overview stat-block">
                <div class="isloading" ng-if="!dataMetrics">Loading
                    <br/><img src="assets/images/ajax-loader_blue.gif">
                </div>
                <div class="details" ng-if="dataMetrics">
                    <div class="title"><a href="/metrics"><span style="font-weight:bold;color:#87CEEB">{{metricsNb|| 0 }}</span> Metrics</a>
                    </div>
                    <nvd3 options="optionsMetrics" data="dataMetrics"></nvd3>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4">
            <div class="stats-overview stat-block">
                <div class="isloading" ng-if="!dataAlerts">Loading
                    <br/><img src="assets/images/ajax-loader_blue.gif">
                </div>
                <div class="details" ng-if="dataAlerts">
                    <div class="title"><span style="font-weight:bold;color:#CB4B16">{{alertsNb || 0 }}</span> Alerts</div>
                    <nvd3 options="optionsAlerts" data="dataAlerts"></nvd3>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4">
            <div class="stats-overview stat-block">
                <div class="isloading" ng-if="!dataGoals">Loading
                    <br/><img src="assets/images/ajax-loader_blue.gif">
                </div>
                <div class="details" ng-if="dataGoals">
                    <div class="title"><span style="font-weight:bold;color:#2CA02C">{{goalsNb || '-'}}%</span> Goals</div>
                    <nvd3 options="optionsGoals" data="dataGoals"></nvd3>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4">
            <div class="stats-overview stat-block">
                <div class="isloading" ng-if="!dataConfidence">Loading
                    <br/><img src="assets/images/ajax-loader_blue.gif">
                </div>
                <div class="details" ng-if="dataConfidence">
                    <div class="title"><span style="font-weight:bold;color:#bcbd22">{{confidenceMean || '-'}}%</span> Confidence</div>
                    <nvd3 options="optionsConfidence" data="dataConfidence"></nvd3>
                </div>
            </div>
        </div>
    </div>
    <!-- END OVERVIEW STATISTIC BARS-->
</div>
<div class="row">
    <div class="col-md-6 col-sm-6">
        <div class="portlet">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-bell-o"></i>myTasks
                </div>
                <div class="tools">
                    <div class="actions pull-right" style="margin-top:-10px;padding-right:15px">
                        <div class="btn-group" style="background:#FFFFFF">
                            <a class="btn dropdown-toggle" href="#" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">  Filter : {{filterNotification}} <i class="fa fa-angle-down"></i></a>
                            <ul class="dropdown-menu pull-right" style="width:300px">
                                <li>
                                    <a href="#" ng-click="filterNotification='Actor view'"><b>Actor view</b> <small class="text-muted">(My active tasks)</small></a>
                                </li>
                                <li>
                                    <li>
                                        <a href="#" ng-click="filterNotification='God view'"><b>God View </b><small class="text-muted">(All tasks)</small></a>
                                    </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="portlet-body">
                <div class="isloading" ng-if="!tasksToNotify">Loading
                    <br/><img src="assets/images/ajax-loader_blue.gif">
                </div>
                        <div class="scroller"  data-always-visible="1" data-rail-visible="0">
                            <ul class="feeds">
                              <li class="bg-lightgrey">
                                  <a>
                                      <div class="col1">
                                          <div class="cont">
                                              <div class="cont-col1">
                                                  <div class="label label-sm label-default">
                                                      <i class="fa fa-info-circle"></i>
                                                  </div>
                                              </div>
                                              <div class="cont-col2 qs">
                                                  <div class="desc">
                                                      <small>
                                                      Task name <br>
                                                    <span style="color:grey"> In Grey, Targeted task infos.</span>
                                                    <span class="text-danger"> In red, Last reestimated infos which need focus</span>
                                                <br>
                                                    <span style="color:grey">  <i class="fa fa-crosshairs"></i> Start Date --[ Workload  <span class="text-danger label-lightdanger">+ Overcharge </span><span class="label-lightwarning">/ Undercharge </span> ]--> End Date </span>
                                                    <span class="label label-sm label-lightdanger">  <span class="text-danger">Delayed delivery date </span></span>
                                                    <br><span style="color:orange"> In Orange, task with old infos, which need new metrics.</span>
                                                     </small>
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                                      <div class="col2">
                                          <div class="date">
                                              <span style="color:orange" ng-show="task.timebetween < 0 && task.timebetween !== null ">{{ Math.abs(task.timebetween) }} days ago</span>
                                              <span ng-show="task.timebetween > 0 && task.timebetween !== null">in {{ Math.abs(task.timebetween) }} days </span>
                                              <span style="color:orange" ng-show=" task.lastmetric === 'undefined'"> No metrics </span>
                                              <span class="label label-sm label-warning " ng-show="task.timebetween < 0 && task.timebetween !== null "> Need Metric</span>
                                          </div>
                                      </div>
                                  </a>
                              </li>
                                <li ng-repeat="task in tasksToNotify | orderBy:'endDate'">
                                    <a ng-href="/task/{{task._id}}">
                                        <div class="col1">
                                            <div class="cont">
                                                <div class="cont-col1">
                                                    <div class="label label-sm label-danger" ng-show="task.lastmetric.progressStatus ==='Late' ">
                                                        <i class="fa fa-bell"></i>
                                                    </div>
                                                    <div class="label label-sm label-warning" ng-show="(task.timebetween < 0 && task.timebetween !== null && task.lastmetric.progressStatus !=='Late' ) || task.lastmetric.progressStatus ==='At Risk' ">
                                                        <i class="fa fa-clock-o"></i>
                                                    </div>
                                                    <div class="label label-sm label-success" ng-show="(task.timebetween > 0 && task.timebetween !== null && task.lastmetric.progressStatus !=='Late' && task.lastmetric.progressStatus !=='At Risk')">
                                                        <i class="fa fa-clock-o"></i>
                                                    </div>
                                                </div>
                                                <div class="cont-col2 qs">
                                                    <div class="desc" popover-html-unsafe="Context : {{task.context}} </p>  Activity : {{task.activity}} " popover-trigger="mouseenter" popover-title="Perimeter" popover-placement="right" popover-delay="1000">
                                                        {{task.name}} <br>
                                                      <span style="color:grey">
                                                         <i class="fa fa-crosshairs"></i> {{task.startDate | date:'dd/MM/yyyy'}} --[ {{task.load}}
                                                         <span class="text-danger label-lightdanger" ng-if="task.lastmetric.projectedWorkload - task.load > 0">+ {{Math.round((task.lastmetric.projectedWorkload - task.load)*10)/10}}</span>
                                                         <span class="label-lightwarning" ng-if="task.lastmetric.projectedWorkload - task.load < 0">- {{Math.round((task.lastmetric.projectedWorkload - task.load)*10*-1)/10}}</span>
                                                          ]--> {{task.endDate | date:'dd/MM/yyyy'}}
                                                      </span>
                                                      <span class="label label-sm label-lightdanger" ng-if="task.lastmetric.progressStatus =='Late' || task.lastmetric.progressStatus =='At Risk'">
                                                        <span class="text-danger"> {{task.lastmetric.progressStatus || 'No metrics'}}
                                                          <span ng-if="task.lastmetric.endDate !== task.endDate"> --> {{task.lastmetric.endDate | date:'dd/MM/yyyy'}} </span>
                                                        </span>
                                                      </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col2">
                                            <div class="date">
                                                <span style="color:orange" ng-show="task.timebetween < 0 && task.timebetween !== null ">{{ Math.abs(task.timebetween) }} days ago</span>
                                                <span ng-show="task.timebetween > 0 && task.timebetween !== null">in {{ Math.abs(task.timebetween) }} days </span>
                                                <span style="color:orange" ng-show=" task.lastmetric === 'undefined'"> No metrics </span>
                                                <span class="label label-sm label-warning " ng-show="task.timebetween < 0 && task.timebetween !== null "> Need Metric</span>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>


                    <!--END TABS-->
            </div>
        </div>
    </div>
    <div class="col-md-6 col-sm-6">
        <!-- BEGIN OVERVIEW STATISTIC BLOCKS-->
        <div class="portlet">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-bookmark"></i>myDashboards
                </div>
                <div class="tools">
                    <a href="/dashboards"><i class="fa fa-plus-circle"></i> Attach a new one</a>
                </div>
            </div>
            <div class="portlet-body">
                <div class="isloading" ng-if="!dashboards">Loading
                    <br/><img src="assets/images/ajax-loader_blue.gif">
                </div>
                <div class="table-scrollable">
                    <table class="table table-striped  table-hover dataTable no-footer " role="grid">
                        <thead>
                            <tr>
                                <th colspan="3" style="width:60%">
                                    Name
                                </th>
                                <th colspan="2" style="width:30%;text-align: center;">
                                    Tasks
                                </th>

                            </tr>
                            <tr role="row" style="height:10px">
                                <th style="width:55%;padding:0">
                                </th>
                                <th style="background:#eee;width:15%;text-align: center; ">
                                    <small class="text-muted">Goals</small>
                                </th>
                                <th style="background:#eee;width:8%;text-align: center; ">
                                  <small class="text-muted"> Alerts</small>
                                </th>
                                <th style="width:8%;text-align: right;">
                                    <small class="text-muted"> On Going </small>
                                </th>
                                <th style="font-size:11px;width:5%;text-align: left;">
                                    <small style="color:#EE6A50"> To feed</small>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="ajaxContent">
                            <tr role="row" ng-repeat="dashboard in dashboards | orderBy:'name' track by dashboard._id">
                                <td class="sorting_1">
                                    <div popover-html-unsafe="Context : {{dashboard.context || 'All'}} </p>  Activity : {{dashboard.activity || 'All'}} " popover-trigger="mouseenter" popover-title="Perimeter" popover-placement="left">
                                        <span style="font-size:15px"><a href="/dashboard/{{dashboard._id}}" >{{dashboard.name}} </a></span>
                                    </div>
                                </td>
                                <td style="background:#eee;text-align: center;   ">
                                    <span ng-if="dashboards" class="badge" ng-style="goalBgColor(dashboard.kpisValue)" style="height:15px;line-height:10px;width:15px;margin-right: 15px">&nbsp;&nbsp;</span>
                                    <span ng-style="goalColor(dashboard.kpisValue)" style="font-size:22px">{{dashboard.kpisValue}}<span style="font-size:15px" ng-if="dashboards">% </span></span> <span class="badge" style="background:green;width:25px;font-size:15px" ng-if="dashboard.dataGoals === '####'">{{dashboard.nbGoals}}</span>
                                </td>
                                <td style="background:#eee;text-align: center;   ">
                                  <span ng-style="alertColor(dashboard.alertsValue)" style="font-size:22px">{{dashboard.alertsValue}}</span>
                                </td>
                                <td style="font-size:18px;text-align: right;">
                                    <span style="color:#316BCD">{{dashboard.openTasksNb}}</span>
                                </td>
                                <td style="font-size:16px;text-align: center">
                                    <span style="color:#EE6A50">{{dashboard.toFeedTasksNb}}</span>
                                </td>
                            </tr>
                            <tr style="background:#eee;text-align:right">
                                <td colspan="6">
                                    <a href="/settings#dashboards" ng-if="dashboards.length > 0"><i class="fa fa-reorder"></i> Manage/remove dashboards</a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
