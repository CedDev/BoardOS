<div ng-include="'components/navbar/navbar.html'"></div>
<div class="row">
    <!-- BEGIN OVERVIEW STATISTIC BARS-->
    <div class="row stats-overview-cont">

       <div class="col-md-2 col-sm-4">
        <div class="stats-overview stat-block">
           <div class="details">
            <div class="title"><a href="/KPIs"><span style="font-weight:bold;color:#1f77b4">{{dataDashboards.kpis.length}}</span> KPIs</a></div>
            <nvd3 options="options" data="dataKPIs"></nvd3>
        </div>
    </div>
</div>

<div class="col-md-2 col-sm-4">
    <div class="stats-overview stat-block" >
       <div class="details">
        <div class="title"><a href="/tasks"><span style="font-weight:bold;color:#9467bd">{{dataDashboards.tasks.length}}</span> Tasks</a></div>
        <nvd3 options="optionsTasks" data="dataTasks"></nvd3>
    </div>
</div>
</div>

<div class="col-md-2 col-sm-4">
    <div class="stats-overview stat-block">
       <div class="details">
        <div class="title"><a href="/metrics"><span style="font-weight:bold;color:#87CEEB">{{dataDashboards.metrics.length}}</span> Metrics</a></div>
        <nvd3 options="optionsMetrics" data="dataMetrics"></nvd3>
    </div>
</div>
</div>
  <div class="col-md-2 col-sm-4">
    <div class="stats-overview stat-block">
     <div class="details">
      <div class="title"><span style="font-weight:bold;color:#CB4B16">{{alertsNb}}</span> Alerts</div>
      <nvd3 options="optionsAlerts" data="dataAlerts"></nvd3>
    </div>
  </div>
</div>

<div class="col-md-2 col-sm-4">
  <div class="stats-overview stat-block">
   <div class="details">
    <div class="title"><span style="font-weight:bold;color:#2CA02C">{{goalsNb}}%</span> Goals</div>
    <nvd3 options="optionsGoals" data="dataGoals"></nvd3>
  </div>
</div>
</div>

<div class="col-md-2 col-sm-4">
    <div class="stats-overview stat-block">
       <div class="details">
        <div class="title"><span style="font-weight:bold;color:#bcbd22">{{confidence}}%</span> Confidence</div>
        <nvd3 options="optionsConfidence" data="dataConfidence"></nvd3>
    </div>
</div>
</div>
</div>
<!-- END OVERVIEW STATISTIC BARS-->
</div>
<div class="row">
    <div class="col-md-6 col-sm-6">
        <div class="portlet">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-bell-o"></i>Notifications
                </div>
                <div class="tools">
                    <a href="" class="collapse"></a>
                    <a href="#portlet-config" data-toggle="modal" class="config"></a>
                    <a href="" class="reload"></a>
                    <a href="" class="remove"></a>
                </div>
            </div>
            <div class="portlet-body">
                <!--BEGIN TABS-->
                <tabset>
                    <tab heading="Metrics">
                        <div class="scroller" style="height: 300px;overflow:auto" data-always-visible="1" data-rail-visible="0">
                            <ul class="feeds">
                                <li ng-repeat="task in dataDashboards.tasks | filter:{$:'!Finished'} | orderBy:'timebetween'">
                                    <a ng-href="/task/{{task._id}}">
                                        <div class="col1">
                                            <div class="cont">
                                                <div class="cont-col1">
                                                    <div class="label label-sm label-danger" ng-show="task.timebetween <= 0 && task.timebetween !== null ">
                                                        <i class="fa fa-bell"></i>
                                                    </div>
                                                    <div class="label label-sm label-default" ng-show="task.timebetween > 0 && task.timebetween !== null ">
                                                        <i class="fa fa-clock-o"></i>
                                                    </div>
                                                </div>
                                                <div class="cont-col2 qs">
                                                    <div class="desc" popover-html-unsafe="Context : {{task.context}} </p>  Activity : {{task.activity}} " popover-trigger="mouseenter" popover-title="Perimeter" popover-placement="right" popover-delay ="1000">
                                                        {{task.name}} 
                                                        <span class="label label-sm label-danger " ng-show="task.timebetween <= 0 && task.timebetween !== null "> Take action</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col2">
                                            <div class="date">
                                                <span style="color:red" ng-show="task.timebetween <= 0 && task.timebetween !== null ">{{ Math.abs(task.timebetween) }} days ago</span>
                                                <span ng-show="task.timebetween > 0 && task.timebetween !== null" >in {{ Math.abs(task.timebetween) }} days </span>
                                                <span style="color:orange" ng-show="task.timebetween === null" > no defined KPI </span>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </tab>
                    <tab>
                        <tab-heading>
                        Close Supervising 
                        <span class="badge badge-danger"> {{taskToSupervise.length}}</span>
                    </tab-heading>
                    <div class="scroller" style="height: 300px;overflow:auto" data-always-visible="1" data-rail-visible="0">
                        <ul class="feeds">
                            <li ng-repeat="task in taskToSupervise = (dataDashboards.tasks | filter:{$:'!On Time'} | orderBy:'timebetween')">
                             <a ng-href="/task/{{task._id}}">
                                <div class="col1">
                                    <div class="cont">
                                        <div class="cont-col1">
                                            <div class="label label-sm label-danger">
                                                <i class="fa fa-eye"></i>
                                            </div>
                                        </div>
                                        <div class="cont-col2">
                                            <div class="desc">
                                              {{task.name}}  <span class="label label-sm label-danger ">   {{task.lastmetric.progressStatus}} </span>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                              <div class="col2">
                                <div class="date">
                                 {{task.timewaited}} days ago
                             </div>
                         </div>
                     </li>
                 </a>
             </ul>
         </div>
     </tab>
     <tab heading="Calendar">
        <div class="scroller" style="height: 300px;overflow:auto" data-always-visible="1" data-rail-visible1="1">
            <ul class="feeds">
                <li>
                    <a href="#">
                        <div class="col1">
                            <div class="cont">
                                <div class="cont-col1">
                                    <div class="label label-sm label-success">
                                        <i class="fa fa-calendar"></i>
                                    </div>
                                </div>
                                <div class="cont-col2">
                                    <div class="desc">
                                        CL3-78989-012 FVFP
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col2">
                            <div class="date">
                                Today
                            </div>
                        </div>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <div class="col1">
                            <div class="cont">
                                <div class="cont-col1">
                                    <div class="label label-sm label-success">
                                        <i class="fa fa-calendar"></i>
                                    </div>
                                </div>
                                <div class="cont-col2">
                                    <div class="desc">
                                        TD CL3-20098-074 End
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col2">
                            <div class="date">
                                In 10 days
                            </div>
                        </div>
                    </a>
                </li>
            </ul>
        </div>
    </tab>
    <tab heading="Journal Log">
        <div class="scroller" style="height: 300px;overflow:auto" data-always-visible="1" data-rail-visible1="1">
            <ul class="feeds">
                <li ng-repeat="log in logs | limitTo:50 ">
                    <div class="col1">
                        <div class="cont">
                            <div class="cont-col1">
                                <div >
                                    <img alt="{{log.actor}}" ng-src="assets/images/avatars/{{log.actor}}.png" style="width:25px" class="img-circle"/>
                                </div>
                            </div>
                            <div class="cont-col2">
                                <div class="desc">
                                    {{log.info}}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col2">
                        <div class="date">
                            {{log.moment}}
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </tab>
</tabset>
<div class="tab-content">
</div>
<!--END TABS-->
</div>
</div>
</div>
<div class="col-md-6 col-sm-6"> 
    <!-- BEGIN OVERVIEW STATISTIC BLOCKS-->
    <div class="portlet">
        <div class="portlet-title">
            <div class="caption">
                <i class="fa fa-bookmark"></i>Bookmarked Dashboards
            </div>
            <div class="tools">
                <a href="" class="collapse"></a>
                <a href="#portlet-config" data-toggle="modal" class="config"></a>
                <a href="" class="reload"></a>
                <a href="" class="remove"></a>
            </div>
        </div>
        <div class="portlet-body">

            <div class="table-scrollable" >
                <table class="table table-striped  table-hover dataTable no-footer" role="grid">
                    <thead>
                        <tr role="row">
                            <th style="width:60%">
                                Name
                            </th>
                            <th style="width:20%">
                                Goals
                            </th>
                            <th style="width:20%">
                                Alerts
                            </th>
                            <th style="width:10%">
                                Last Info
                            </th>
                        </thead>
                        <tbody>

                            <tr role="row" ng-repeat="dashboard in dashboards | orderBy:'name' track by dashboard._id">
                                <td class="sorting_1">
                                    <div popover-html-unsafe="Context : {{dashboard.context || 'All'}} </p>  Activity : {{dashboard.activity || 'All'}} " popover-trigger="mouseenter" popover-title="Perimeter" popover-placement="left" >
                                        <span style="font-size:15px"><a href="/dashboard/{{dashboard._id}}" >{{dashboard.name}} </a></span>
                                    </div>
                                </td>
                                <td>
                                    <span ng-style="goalColor(dashboard.dataGoals)" style="font-size:22px">{{dashboard.dataGoals}}<span style="font-size:15px" ng-if="dashboard.dataGoals !== '-'">% </span></span> <span class="badge" style="background:green;width:25px;font-size:15px" ng-if="dashboard.dataGoals === '####'"  >{{dashboard.nbGoals}}</span>
                                </td>
                                <td>
                                   <span ng-style="alertColor(dashboard.dataAlerts)" style="font-size:22px">{{dashboard.dataAlerts}}</span><span style="color:lightgrey;font-size:15px" ng-if="dashboard.dataGoals === '####'" > /{{dashboard.nbAlerts}}</span>
                               </td>
                               <td>
                                <span style="color:lightgrey">xx days ago</span>
                            </td>
                        </tr>
                        <tr style="background:#eee;text-align:right">
                            <td colspan="4"><a href="/dashboards" ><i class="fa fa-plus-circle"></i> Attach a new one</a></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</div>
</div>