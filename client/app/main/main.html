<div ng-include="'components/navbar/navbar.html'"></div>
<div class="row">
    <!-- BEGIN OVERVIEW STATISTIC BARS-->
    <div class="row stats-overview-cont">
        <div class="col-md-2 col-sm-4 ">
            <div class="stats-overview stat-block">
                <div class="isloading" ng-if="!dataKPIs">Loading
                    <br/><img src="assets/images/ajax-loader_blue.gif">
                </div>
                <div class="details " ng-if="dataKPIs">
                    <div class="title"><a href="/KPIs"><span style="font-weight:bold;color:#1f77b4">{{KPIs.length}}</span> KPIs</a>
                    </div>
                    <nvd3 options="options" data="dataKPIs"></nvd3>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4">
            <div class="stats-overview stat-block">
                <div class="isloading" ng-if="!dataTasks">Loading
                    <br/><img src="assets/images/ajax-loader_blue.gif">
                </div>
                <div class="details" ng-if="dataTasks">
                    <div class="title"><a href="/tasks"><span style="font-weight:bold;color:#9467bd">{{tasksNb|| 0 }}</span> Tasks</a>
                    </div>
                    <nvd3 options="optionsTasks" data="dataTasks"></nvd3>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4">
            <div class="stats-overview stat-block">
                <div class="isloading" ng-if="!dataMetrics">Loading
                    <br/><img src="assets/images/ajax-loader_blue.gif">
                </div>
                <div class="details" ng-if="dataMetrics">
                    <div class="title"><a href="/metrics"><span style="font-weight:bold;color:#87CEEB">{{metricsNb|| 0 }}</span> Metrics</a>
                    </div>
                    <nvd3 options="optionsMetrics" data="dataMetrics"></nvd3>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4">
            <div class="stats-overview stat-block">
                <div class="isloading" ng-if="!dataAlerts">Loading
                    <br/><img src="assets/images/ajax-loader_blue.gif">
                </div>
                <div class="details" ng-if="dataAlerts">
                    <div class="title"><span style="font-weight:bold;color:#CB4B16">{{alertsNb || 0 }}</span> Alerts</div>
                    <nvd3 options="optionsAlerts" data="dataAlerts"></nvd3>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4">
            <div class="stats-overview stat-block">
                <div class="isloading" ng-if="!dataGoals">Loading
                    <br/><img src="assets/images/ajax-loader_blue.gif">
                </div>
                <div class="details" ng-if="dataGoals">
                    <div class="title"><span style="font-weight:bold;color:#2CA02C">{{goalsNb || '-'}}%</span> Goals</div>
                    <nvd3 options="optionsGoals" data="dataGoals"></nvd3>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4">
            <div class="stats-overview stat-block">
                <div class="isloading" ng-if="!dataConfidence">Loading
                    <br/><img src="assets/images/ajax-loader_blue.gif">
                </div>
                <div class="details" ng-if="dataConfidence">
                    <div class="title"><span style="font-weight:bold;color:#bcbd22">{{confidenceMean || '-'}}%</span> Confidence</div>
                    <nvd3 options="optionsConfidence" data="dataConfidence"></nvd3>
                </div>
            </div>
        </div>
    </div>
    <!-- END OVERVIEW STATISTIC BARS-->
</div>
<div class="row">
    <div class="col-md-6 col-sm-6">
        <div class="portlet">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-bell-o"></i>myTasks
                </div>
                <div class="tools">
                    <div class="actions pull-right" style="margin-top:-10px;padding-right:15px">
                        <div class="btn-group" style="background:#FFFFFF">
                            <a class="btn dropdown-toggle" href="#" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">  Filter : {{filterNotification}} <i class="fa fa-angle-down"></i></a>
                            <ul class="dropdown-menu pull-right" style="width:300px">
                                <li>
                                    <a href="#" ng-click="filterNotification='Actor view'"><b>Actor view</b> <small class="text-muted">(My active tasks)</small></a>
                                </li>
                                <li>
                                    <!--                                 <a class="trigger right-caret"><b>Manager View </b><small class="text-muted">(Tasks from your dashboards)</small> </a>
                                    <ul class="dropdown-menu sub-menu">
                                    <li ng-if="dashboards" ng-repeat="dashboard in dashboards | orderBy:'name' track by dashboard._id">
                                        <li><a href="#" ng-click="filterNotification='Manager view';filterDashboard=dashboard._id">{{dashboard.name}}</a></li>
                                    </ul>
                                </li> -->
                                    <li>
                                        <a href="#" ng-click="filterNotification='God view'"><b>God View </b><small class="text-muted">(All tasks)</small></a>
                                    </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="portlet-body">
                <div class="isloading" ng-if="!tasksToNotify">Loading
                    <br/><img src="assets/images/ajax-loader_blue.gif">
                </div>
                <!--BEGIN TABS-->
                <tabset>
                    <tab>
                        <tab-heading>
                            Tasks
                            <span class="badge badge-default"> {{tasksToNotify.length}}</span>
                        </tab-heading>
                        <div class="scroller" style="height:300px;overflow:auto" data-always-visible="1" data-rail-visible="0">
                            <ul class="feeds">
                                <li ng-repeat="task in tasksToNotify | orderBy:'timebetween'">
                                    <a ng-href="/task/{{task._id}}">
                                        <div class="col1">
                                            <div class="cont">
                                                <div class="cont-col1">
                                                    <div class="label label-sm label-danger" ng-show="task.timebetween <= 0 && task.timebetween !== null ">
                                                        <i class="fa fa-bell"></i>
                                                    </div>
                                                    <div class="label label-sm label-default" ng-show="task.timebetween > 0 && task.timebetween !== null ">
                                                        <i class="fa fa-clock-o"></i>
                                                    </div>
                                                </div>
                                                <div class="cont-col2 qs">
                                                    <div class="desc" popover-html-unsafe="Context : {{task.context}} </p>  Activity : {{task.activity}} " popover-trigger="mouseenter" popover-title="Perimeter" popover-placement="right" popover-delay="1000">
                                                        {{task.name}}
                                                        <span class="label label-sm label-danger " ng-show="task.timebetween <= 0 && task.timebetween !== null "> Need Metric</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col2">
                                            <div class="date">
                                                <span style="color:red" ng-show="task.timebetween <= 0 && task.timebetween !== null ">{{ Math.abs(task.timebetween) }} days ago</span>
                                                <span ng-show="task.timebetween > 0 && task.timebetween !== null">in {{ Math.abs(task.timebetween) }} days </span>
                                                <span style="color:orange" ng-show=" task.lastmetric === 'undefined'"> No metrics </span>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </tab>
                    <tab>
                        <tab-heading>
                            Need Supervising
                            <span class="badge badge-danger"> {{taskToSupervise.length}}</span>
                        </tab-heading>
                        <div class="scroller" style="height: 300px;overflow:auto" data-always-visible="1" data-rail-visible="0">
                            <ul class="feeds">
                                <li ng-repeat="task in taskToSupervise = (tasksToNotify | filter:{$:'!On Time'} | orderBy:'timebetween')">
                                    <a ng-href="/task/{{task._id}}">
                                        <div class="col1">
                                            <div class="cont">
                                                <div class="cont-col1">
                                                    <div class="label label-sm label-danger">
                                                        <i class="fa fa-eye"></i>
                                                    </div>
                                                </div>
                                                <div class="cont-col2">
                                                    <div class="desc">
                                                        {{task.name}} <span class="label label-sm label-danger ">   {{task.lastmetric.progressStatus || 'No metrics'}} </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col2">
                                            <div class="date" ng-show="task.lastmetric">
                                                {{task.timewaited}} days ago
                                            </div>
                                        </div>
                                </li>
                                </a>
                            </ul>
                        </div>
                    </tab>
                    <!-- <tab heading="Calendar">
                        <div class="scroller" style="height: 300px;overflow:auto" data-always-visible="1" data-rail-visible1="1">
                            <ul class="feeds">
                                <li>
                                    <a href="#">
                                        <div class="col1">
                                            <div class="cont">
                                                <div class="cont-col1">
                                                    <div class="label label-sm label-success">
                                                        <i class="fa fa-calendar"></i>
                                                    </div>
                                                </div>
                                                <div class="cont-col2">
                                                    <div class="desc">
                                                        CL3-78989-012 FVFP
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col2">
                                            <div class="date">
                                                Today
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <div class="col1">
                                            <div class="cont">
                                                <div class="cont-col1">
                                                    <div class="label label-sm label-success">
                                                        <i class="fa fa-calendar"></i>
                                                    </div>
                                                </div>
                                                <div class="cont-col2">
                                                    <div class="desc">
                                                        TD CL3-20098-074 End
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col2">
                                            <div class="date">
                                                In 10 days
                                            </div>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </tab> 
                    <tab heading="Journal Log">
                        <div class="scroller" style="height: 300px;overflow:auto" data-always-visible="1" data-rail-visible1="1">
                            <ul class="feeds">
                                <li ng-repeat="log in logs | limitTo:50 ">
                                    <div class="col1">
                                        <div class="cont">
                                            <div class="cont-col1">
                                                <div>
                                                    <div popover-html-unsafe="{{log.actor.name}}" popover-trigger="mouseenter" popover-title="Name" popover-placement="right">
                                                        <img ng-src="assets/images/avatars/{{log.actor._id}}.png" style="width:25px" class="img-circle" err-src="assets/images/avatars/avatar.png" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="cont-col2">
                                                <div class="desc">
                                                    {{log.info}}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col2">
                                        <div class="date">
                                            {{log.moment}}
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </tab>
                </tabset>-->
                    <div class="tab-content">
                    </div>
                    <!--END TABS-->
            </div>
        </div>
    </div>
    <div class="col-md-6 col-sm-6">
        <!-- BEGIN OVERVIEW STATISTIC BLOCKS-->
        <div class="portlet">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-bookmark"></i>myDashboards
                </div>
                <div class="tools">
                    <a href="/dashboards"><i class="fa fa-plus-circle"></i> Attach a new one</a>
                </div>
            </div>
            <div class="portlet-body">
                <div class="isloading" ng-if="!dataDashboards">Loading
                    <br/><img src="assets/images/ajax-loader_blue.gif">
                </div>
                <div class="table-scrollable">
                    <table class="table table-striped  table-hover dataTable no-footer " role="grid">
                        <thead>
                            <tr>
                                <th colspan="2" style="width:60%">
                                    Name
                                </th>
                                <th colspan="3" style="width:30%;text-align: center;">
                                    Tasks
                                </th>
                                <th style="width:10%;text-align: center; ">
                                </th>
                            </tr>
                            <tr role="row" style="height:10px">
                                <th style="width:55%;padding:0">
                                </th>
                                <th style="background:#eee;width:15%;text-align: center; ">
                                    <small class="text-muted">Goals</small>
                                </th>
                                <th style="width:8%;text-align: right;">
                                    <small class="text-muted"> On Going </small>
                                </th>
                                <th style="font-size:11px;width:5%;text-align: left;">
                                    <small style="color:#EE6A50"> To feed</small>
                                </th>
                                <th style="width:8%;text-align: left;">
                                    <small class="text-muted"> All</small>
                                </th>
                                <th style="background:#eee;width:8%;text-align: center; ">
                                    <small class="text-muted"> Alerts</small>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="ajaxContent">
                            <tr role="row" ng-repeat="dashboard in dashboards | orderBy:'name' track by dashboard._id">
                                <td class="sorting_1">
                                    <div popover-html-unsafe="Context : {{dashboard.context || 'All'}} </p>  Activity : {{dashboard.activity || 'All'}} " popover-trigger="mouseenter" popover-title="Perimeter" popover-placement="left">
                                        <span style="font-size:15px"><a href="/dashboard/{{dashboard._id}}" >{{dashboard.name}} </a></span>
                                    </div>
                                </td>
                                <td style="background:#eee;text-align: center;   ">
                                    <span ng-if="dataDashboards" class="badge" ng-style="goalBgColor(dashboard.dataGoals)" style="height:15px;line-height:10px;width:15px;margin-right: 15px">&nbsp;&nbsp;</span>
                                    <span ng-style="goalColor(dashboard.dataGoals)" style="font-size:22px">{{dashboard.dataGoals}}<span style="font-size:15px" ng-if="dataDashboards">% </span></span> <span class="badge" style="background:green;width:25px;font-size:15px" ng-if="dashboard.dataGoals === '####'">{{dashboard.nbGoals}}</span>
                                </td>
                                <td style="font-size:18px;text-align: right;">
                                    <span style="color:#316BCD">{{dashboard.openTasks.length}}</span>
                                </td>
                                <td style="font-size:11px;text-align: left;padding-top:10px">
                                    <span style="color:#EE6A50">{{dashboard.tasksNeedMetrics.length}}</span>
                                </td>
                                <td style="font-size:18px;text-align: left;">
                                    <span style="color:lightgrey">{{dashboard.tasks.length}}</span>
                                </td>
                                <td style="background:#eee;text-align: center;   ">
                                    <span ng-style="alertColor(dashboard.dataAlerts)" style="font-size:22px">{{dashboard.dataAlerts}}</span><span style="color:lightgrey;font-size:15px" ng-if="dashboard.dataGoals === '####'"> /{{dashboard.nbAlerts}}</span>
                                </td>
                            </tr>
                            <tr style="background:#eee;text-align:right">
                                <td colspan="6">
                                    <a href="/settings#dashboards" ng-if="dashboards.length > 0"><i class="fa fa-reorder"></i> Manage/remove dashboards</a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
