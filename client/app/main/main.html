<div ng-include="'components/navbar/navbar.html'"></div>
<div class="row">
  <!-- BEGIN OVERVIEW STATISTIC BARS-->
  <div class="row stats-overview-cont">
    <div class="col-md-2 col-sm-4">
      <a class="anim-btn"  href="/dashboards">
        <span class="anim-btn-text">Dashboard</span>
        <span class="anim-btn-slide-text">Add a new one</span>
        <span class="anim-btn-icon-right">
          <span>
            <i class="fa fa-2x fa-cog fa-spin fa-fw" aria-hidden="true"></i>
          </span>
        </span>
      </a>
    </div>
    <div class="col-md-1 col-sm-2">
    </div>
    <div class="col-md-2 col-sm-4">
      <div class="stats-overview stat-block">
        <div class="isloading" ng-if="!dataTasks">Loading
          <br/><img src="assets/images/ajax-loader_blue.gif">
        </div>
        <div class="details" ng-if="dataTasks">
          <div class="title">
            <a href="/tasks">
              <span style="font-weight:bold;color:#9467bd">{{tasksNb|| 0 }}</span>
              Tasks</a>
          </div>
          <nvd3 options="optionsTasks" data="dataTasks"></nvd3>
        </div>
      </div>
    </div>
    <div class="col-md-2 col-sm-4">
      <div class="stats-overview stat-block">
        <div class="isloading" ng-if="!dataMetrics">Loading
          <br/><img src="assets/images/ajax-loader_blue.gif">
        </div>
        <div class="details" ng-if="dataMetrics">
          <div class="title">
            <a href="/metrics">
              <span style="font-weight:bold;color:#87CEEB">{{metricsNb|| 0 }}</span>
              Metrics</a>
          </div>
          <nvd3 options="optionsMetrics" data="dataMetrics"></nvd3>
        </div>
      </div>
    </div>
    <div class="col-md-2 col-sm-4">
      <div class="stats-overview stat-block">
        <div class="isloading" ng-if="!dataConfidence">Loading
          <br/><img src="assets/images/ajax-loader_blue.gif">
        </div>
        <div class="details" ng-if="dataConfidence">
          <div class="title">
            <span style="font-weight:bold;color:#bcbd22">{{confidenceMean || '-'}}%</span>
            Confidence</div>
          <nvd3 options="optionsConfidence" data="dataConfidence"></nvd3>
        </div>
      </div>
    </div>
    <div class="col-md-1 col-sm-2">
    </div>
    <div class="col-md-2 col-sm-4 ">
      <a href="/tasks" class="anim-btn">
        <span class="anim-btn-text">Task&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
        <span class="anim-btn-slide-text">Add a new one</span>
        <span class="anim-btn-icon-right">
          <span>
            <i class="fa fa-2x fa-cog fa-spin fa-fw" aria-hidden="true"></i>
          </span>
        </span>
      </a>

    </div>
  </div>
  <!-- END OVERVIEW STATISTIC BARS-->
</div>
<div class="row">
  <div class="col-md-6 col-sm-6">
    <!-- BEGIN OVERVIEW STATISTIC BLOCKS-->
    <div class="portlet">
      <div class="portlet-title">
        <div class="caption">
          <i class="fa fa-dashboard"></i>My Dashboards
        </div>
        <div class="tools">

        </div>
      </div>
      <div class="portlet-body">
        <div class="isloading" ng-if="!dashboards">Loading
          <br/><img src="assets/images/ajax-loader_blue.gif">
        </div>
        <div class="table-scrollable">
          <table class="table table-striped  table-hover dataTable no-footer " role="grid">
            <thead>
              <tr>
                <th colspan="3" style="width:60%">
                  Name
                </th>
                <th colspan="2" style="width:30%;text-align: center;">
                  Tasks
                </th>

              </tr>
              <tr role="row" style="height:10px">
                <th style="width:55%;padding:0"></th>
                <th style="background:#eee;width:15%;text-align: center; ">
                  <small class="text-muted">Goals</small>
                </th>
                <th style="background:#eee;width:8%;text-align: center; ">
                  <small class="text-muted">
                    Alerts</small>
                </th>
                <th style="width:8%;text-align: right;">
                  <small class="text-muted">
                    On Going
                  </small>
                </th>
                <th style="font-size:11px;width:5%;text-align: left;">
                  <small style="color:#EE6A50">
                    To feed</small>
                </th>
              </tr>
            </thead>
            <tbody class="ajaxContent">
              <tr role="row" ng-repeat="dashboard in dashboards | orderBy:'name' track by dashboard._id">
                <td class="sorting_1">
                  <div popover-html-unsafe="Context : {{dashboard.context || 'All'}} </p>  Activity : {{dashboard.activity || 'All'}} " popover-trigger="mouseenter" popover-title="Perimeter" popover-placement="left">
                    <span style="font-size:15px">
                      <a href="/dashboard/{{dashboard._id}}">{{dashboard.name}}
                      </a>
                    </span>
                  </div>
                </td>
                <td style="background:#eee;text-align: center;   ">
                  <span ng-if="dashboards" class="badge" ng-style="goalBgColor(dashboard.kpisValue)" style="height:15px;line-height:10px;width:15px;margin-right: 15px">&nbsp;&nbsp;</span>
                  <span ng-style="goalColor(dashboard.kpisValue)" style="font-size:22px">{{dashboard.kpisValue}}
                    <span style="font-size:15px" ng-if="dashboards">%
                    </span>
                  </span>
                  <span class="badge" style="background:green;width:25px;font-size:15px" ng-if="dashboard.dataGoals === '####'">{{dashboard.nbGoals}}</span>
                </td>
                <td style="background:#eee;text-align: center;   ">
                  <span ng-style="alertColor(dashboard.alertsValue)" style="font-size:22px">{{dashboard.alertsValue}}</span>
                </td>
                <td style="font-size:18px;text-align: right;">
                  <span style="color:#316BCD">{{dashboard.openTasksNb}}</span>
                </td>
                <td style="font-size:16px;text-align: center">
                  <span style="color:#EE6A50">{{dashboard.toFeedTasksNb}}</span>
                </td>
              </tr>
              <tr style="background:#eee;text-align:right">
                <td colspan="6">
                  <a href="/settings#dashboards" ng-if="dashboards.length > 0">
                    <i class="fa fa-reorder"></i>
                    Manage/remove dashboards</a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-6 col-sm-6">
    <div class="portlet">
      <div class="portlet-title">
        <div class="caption">
          <i class="fa  fa-tasks"></i>My Tasks
        </div>
        <div class="pull-right" style="margin-top:-7px;">
          <a class="btn btn-sm btn-info pull-right" role="button" data-toggle="collapse" href="#collapseHelp" aria-expanded="false" aria-controls="collapseHelp">
            <i class="fa fa-info-circle"></i>
            Show Help
          </a>
        </div>
      </div>
      <div class="portlet-body">
        <div class="isloading" ng-if="!tasksToNotify">Loading
          <br/><img src="assets/images/ajax-loader_blue.gif">
        </div>
        <div class="scroller" data-always-visible="1" data-rail-visible="0">
          <ul class="feeds">
            <li class="bg-lightgrey">

              <a>
                <div class="col1">
                  <div class="cont">
                    <div class="cont-col1">

                    </div>
                    <div class="cont-col2 qs">
                      <div class="desc collapse" id="collapseHelp">
                        <div>
                          Task name
                          <br>
                          <span style="color:grey">
                            In Grey, Targeted task infos.</span>
                          <span class="text-danger">
                            In red, Last reestimated infos which need focus</span>
                          <br>
                          <span style="color:grey">
                            <i class="fa fa-crosshairs"></i>
                            Start Date --[ Workload
                            <span class="text-danger label-lightdanger">+ Overcharge
                            </span>
                            <span class="label-lightwarning">/ Undercharge
                            </span>
                            ]--> End Date
                          </span>
                          <span class="label label-sm label-lightdanger">
                            <span class="text-danger">Delayed delivery date
                            </span>
                          </span>
                          <br>
                          <span style="color:orange">
                            In Orange, task with old infos, which need new metrics.</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

              </a>
            </li>
            <li ng-repeat="task in tasksToNotify | orderBy:'endDate'">
              <a ng-href="/task/{{task._id}}">
                <div class="col1">
                  <div class="cont">
                    <div class="cont-col1">
                      <div class="label label-sm label-danger" ng-show="task.metrics[task.metrics.length - 1].progressStatus ==='Late' || task.metrics[task.metrics.length - 1].projectedWorkload > task.metrics[task.metrics.length - 1].targetLoad ">
                        <i class="fa fa-bell"></i>
                      </div>
                      <div class="label label-sm label-warning" ng-show="(task.needToFeed && task.metrics[task.metrics.length - 1].progressStatus !=='Late' && task.metrics[task.metrics.length - 1].projectedWorkload <= task.metrics[task.metrics.length - 1].targetLoad ) || task.metrics[task.metrics.length - 1].progressStatus ==='At Risk' ">
                        <i class="fa fa-clock-o"></i>
                      </div>
                      <div class="label label-sm label-success" ng-show="(!task.needToFeed && task.metrics[task.metrics.length - 1].progressStatus !=='Late' && task.metrics[task.metrics.length - 1].progressStatus !=='At Risk' && task.metrics[task.metrics.length - 1].projectedWorkload <= task.metrics[task.metrics.length - 1].targetLoad)">
                        <i class="fa fa-clock-o"></i>
                      </div>
                    </div>
                    <div class="cont-col2 qs">
                      <div class="desc" popover-html-unsafe="Context : {{task.context}} </p>  Activity : {{task.activity}} " popover-trigger="mouseenter" popover-title="Perimeter" popover-placement="right" popover-delay="1000">
                        {{task.name}}
                        <br>
                        <span style="color:grey">
                          <i class="fa fa-crosshairs"></i>
                          {{task.metrics[task.metrics.length - 1].targetstartDate | date:'dd/MM/yyyy'}}
                          --[
                          {{task.metrics[task.metrics.length - 1].targetLoad}}
                          <span class="text-danger label-lightdanger" ng-if="task.metrics[task.metrics.length - 1].projectedWorkload - task.metrics[task.metrics.length - 1].targetLoad > 0">+
                            {{Math.round((task.metrics[task.metrics.length - 1].projectedWorkload - task.metrics[task.metrics.length - 1].targetLoad)*10)/10}}</span>
                          <span class="label-lightwarning" ng-if="task.metrics[task.metrics.length - 1].projectedWorkload - task.metrics[task.metrics.length - 1].targetLoad < 0">-
                            {{Math.round((task.metrics[task.metrics.length - 1].projectedWorkload - task.metrics[task.metrics.length - 1].targetLoad)*10*-1)/10}}</span>
                          ]-->
                          {{task.metrics[task.metrics.length - 1].targetEndDate | date:'dd/MM/yyyy'}}
                        </span>
                        <span class="label label-sm label-lightdanger" ng-if="task.metrics[task.metrics.length - 1].progressStatus =='Late' || task.metrics[task.metrics.length - 1].progressStatus =='At Risk'">
                          <span class="text-danger">
                            {{task.metrics[task.metrics.length - 1].progressStatus || 'No metrics'}}
                            <span ng-if="task.metrics[task.metrics.length - 1].endDate !== task.metrics[task.metrics.length - 1].targetEndDate">
                              -->
                              {{task.metrics[task.metrics.length - 1].endDate | date:'dd/MM/yyyy'}}
                            </span>
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col2">
                  <div class="date">
                    <span style="color:orange" ng-show=" task.metrics[task.metrics.length - 1] === undefined">
                      No metrics
                    </span>
                    <span class="label label-sm label-warning " ng-show="task.needToFeed">
                      Need Metric</span>
                  </div>
                </div>
              </a>
            </li>
          </ul>
        </div>
        <!--END TABS-->
      </div>
    </div>
  </div>
</div>
